<div class="filter-projects" [class.collapsed]="collapsed">
  <div class="filter-header">
    <span class="material-symbols-outlined" *ngIf="collapsed" (click)="toggleCollapse()">chevron_right</span>
    <h3>Filter Contracts</h3>
    <button class="filter-dots" (click)="toggleFilterMenu($event)">...</button>
    <div class="filter-dots-menu" *ngIf="filterMenuOpen" (click)="$event.stopPropagation()">
      <ul>
        <li (mouseenter)="openSubMenu('export')" (mouseleave)="closeSubMenu('export')">
          Export Contract
          <ul class="submenu" *ngIf="activeSubMenu === 'export'">
            <li (click)="exportContract('csv')">Export as CSV</li>
            <li (click)="exportContract('xlsx')">Export as Excel</li>
          </ul>
        </li>
        <li (mouseenter)="openSubMenu('save')" (mouseleave)="closeSubMenu('save')">
          Save Filter
          <ul class="submenu" *ngIf="activeSubMenu === 'save'">
            <li (click)="saveFilter('current')">Save Current Filter</li>
            <li (click)="saveFilter('asNew')">Save as New Filter</li>
          </ul>
        </li>
        <li (mouseenter)="openSubMenu('load')" (mouseleave)="closeSubMenu('load')">
          Load Filter
          <ul class="submenu" *ngIf="activeSubMenu === 'load'">
            <li (click)="loadFilter('recent')">Load Recent Filter</li>
            <li (click)="loadFilter('saved')">Load Saved Filters</li>
          </ul>
        </li>
        <li class="menu-divider"></li>
        <li class="menu-instruction">Instruction to use</li>
        <li class="menu-last-uploaded">Last uploaded: {{ lastUploadedDate }} by {{ lastUploadedBy }}</li>
      </ul>
    </div>
    <button class="collapse-btn" (click)="toggleCollapse()">
      <span class="material-symbols-outlined" *ngIf="!collapsed">chevron_left</span>
      <span class="material-symbols-outlined" *ngIf="collapsed">chevron_right</span>
    </button>
  </div>
  <div class="filter-content" *ngIf="!collapsed">
    <kendo-textbox #customInput (valueChange)="onFilterTermChange($event)" [clearButton]="true"
      placeholder="Search job number or contract name">
      <ng-template kendoTextBoxPrefixTemplate>
        <span class="material-symbols-outlined search-icon">search</span>
      </ng-template>
    </kendo-textbox>
    <div class="panelbar-wrapper">
      <kendo-expansionpanel title="Advance Search" [expanded]="false" id="filter">
     
          <div class="advance-search-row">
            <button class="clear-filter-link" (click)="clearAdvanceFilters()">Clear Filter</button>
          </div>
          <div class="advance-search-row">
            <kendo-multiselect
              [data]="deliveryYears"
              [(ngModel)]="selectedDeliveryYears"
              [placeholder]="'Delivery Year'"
              [checkboxes]="true"
              [autoClose]="false"
              class="advance-multiselect"
            ></kendo-multiselect>
            <kendo-multiselect
              [data]="racYears"
              [(ngModel)]="selectedRacYears"
              [placeholder]="'RAC Year'"
              [checkboxes]="true"
              [autoClose]="false"
              class="advance-multiselect"
            ></kendo-multiselect>
            <kendo-multiselect
              [data]="projectStatuses"
              [(ngModel)]="selectedProjectStatuses"
              [placeholder]="'Project Status'"
              [checkboxes]="true"
              [autoClose]="false"
              class="advance-multiselect"
            ></kendo-multiselect>
            <kendo-multiselect
              [data]="drivers"
              [(ngModel)]="selectedDrivers"
              [placeholder]="'Driver'"
              [checkboxes]="true"
              [autoClose]="false"
              class="advance-multiselect"
            ></kendo-multiselect>
            <kendo-multiselect
              [data]="connectors"
              [(ngModel)]="selectedConnectors"
              [placeholder]="'Connector'"
              [checkboxes]="true"
              [autoClose]="false"
              class="advance-multiselect"
            ></kendo-multiselect>
            <kendo-multiselect
              [data]="installationCountries"
              [(ngModel)]="selectedInstallationCountries"
              [placeholder]="'Installation Country'"
              [checkboxes]="true"
              [autoClose]="false"
              class="advance-multiselect"
            ></kendo-multiselect>
          </div>
       
      </kendo-expansionpanel>
    </div>
    <kendo-tabstrip (tabSelect)="onTabSelect($event)" class="searchTabs">
      <kendo-tabstrip-tab title="My Contracts" [selected]="activeTabIndex === 0">
        <ng-template kendoTabContent>
          <div class="content">
            <kendo-checkbox [checkedState]="allChecked" (change)="onSelectAllChange($event)" ></kendo-checkbox>&nbsp;&nbsp;Current Projects 
            <kendo-treeview kendoTreeViewExpandable [nodes]="filteredData" [children]="children" [hasChildren]="hasChildren"
              [filter]="filterTerm" (checkedKeysChange)="onNodeSelect($event)" textField="text"
              [kendoTreeViewCheckable]="checkableSettings" [(checkedKeys)]="checkedKeys">
              <ng-template kendoTreeViewNodeTemplate let-dataItem>
                {{dataItem.contractName ? dataItem.contractName : dataItem.groupName}}
                <span class="material-symbols-outlined filled-star" style="font-variation-settings: 'FILL' 1; color: #209474;" (click)="addToFavourites(dataItem.contractName ? dataItem.contractName : dataItem.groupName)">star</span>
              </ng-template>
            </kendo-treeview>
          </div>
        </ng-template>
      </kendo-tabstrip-tab>
      <kendo-tabstrip-tab title="All Contracts" [selected]="activeTabIndex === 1">
        <ng-template kendoTabContent>
          <div class="content">
          </div>
        </ng-template>
      </kendo-tabstrip-tab>
      <kendo-tabstrip-tab title="Favourites" [selected]="activeTabIndex === 2">
        <ng-template kendoTabContent>
          <div class="content">
            <kendo-treeview kendoTreeViewExpandable [nodes]="favourites" [children]="children" [hasChildren]="hasChildren"
              textField="text" [kendoTreeViewCheckable]="checkableSettings" [(checkedKeys)]="checkedKeys">
              <ng-template kendoTreeViewNodeTemplate let-dataItem>
                {{dataItem.contractName ? dataItem.contractName : dataItem.groupName || dataItem.text}}
              </ng-template>
            </kendo-treeview>
          </div>
        </ng-template>
      </kendo-tabstrip-tab>
    </kendo-tabstrip>
  </div>
</div>
